<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Trang ch·ªß sinh vi√™n - DocShare">
    <title>Trang ch·ªß - DocShare</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>ƒêang t·∫£i...</p>
    </div>

    <!-- Notification Toast -->
    <div id="notificationToast" class="notification-toast">
        <span id="toastMessage"></span>
        <button onclick="closeToast()" class="toast-close">&times;</button>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <a href="../index.html" style="text-decoration: none; color: inherit;">
                    <h1>üìö DocShare</h1>
                </a>
                <span class="logo-subtitle">H·ªçc t·∫≠p & Chia s·∫ª</span>
            </div>
            <nav class="nav">
                <a href="../index.html" class="nav-link">
                    <span class="nav-icon">üè†</span>
                    Trang ch·ªß
                </a>
                <a href="../documents/list.html" class="nav-link">
                    <span class="nav-icon">üîç</span>
                    Kh√°m ph√°
                </a>
                <a href="../features.html" class="nav-link">
                    <span class="nav-icon">‚ú®</span>
                    T√≠nh nƒÉng
                </a>
                <a href="../about.html" class="nav-link">
                    <span class="nav-icon">‚ÑπÔ∏è</span>
                    V·ªÅ ch√∫ng t√¥i
                </a>
                <div class="nav-buttons" id="authButtons" style="display: none;">
                    <a href="../login.html" class="btn-login">
                        <span>üîë</span> ƒêƒÉng nh·∫≠p
                    </a>
                    <a href="../register.html" class="btn-register">
                        <span>üìù</span> ƒêƒÉng k√Ω
                    </a>
                </div>
                <!-- User Dropdown (ch·ªâ hi·ªán khi ƒë√£ ƒëƒÉng nh·∫≠p) -->
                <div class="nav-buttons" id="userSection">
                    <a href="../admin/dashboard.html" id="adminLink" class="btn-danger" style="display: none;">
                        <span>üîë</span> Qu·∫£n tr·ªã
                    </a>
                    <div class="user-dropdown">
                        <button class="user-dropdown-btn" onclick="toggleUserDropdown()">
                            <span class="user-icon">üë§</span>
                            <span id="userNameHeader">Ng∆∞·ªùi d√πng</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </button>
                        <div class="user-dropdown-menu" id="userDropdownMenu">
                            <div class="dropdown-header">
                                <span class="user-icon">üë§</span>
                                <span id="dropdownUserEmail" style="margin-left: 8px;">email@example.com</span>
                            </div>
                            <div class="dropdown-content-grid">
                                <a href="./home.html" class="dropdown-item">
                                    <span class="dropdown-icon">üìä</span>
                                    <span>Dashboard</span>
                                </a>
                                <a href="./my-documents.html" class="dropdown-item">
                                    <span class="dropdown-icon">üìÑ</span>
                                    <span>T√†i li·ªáu c·ªßa t√¥i</span>
                                </a>
                                <a href="./upload.html" class="dropdown-item">
                                    <span class="dropdown-icon">‚¨ÜÔ∏è</span>
                                    <span>T·∫£i l√™n</span>
                                </a>
                                <a href="./profile.html" class="dropdown-item">
                                    <span class="dropdown-icon">‚öôÔ∏è</span>
                                    <span>C√†i ƒë·∫∑t</span>
                                </a>
                            </div>
                            <div class="dropdown-divider"></div>
                            <button onclick="logout()" class="dropdown-item dropdown-logout">
                                <span class="dropdown-icon">üö™</span>
                                <span>ƒêƒÉng xu·∫•t</span>
                            </button>
                        </div>
                    </div>
                </div>
            </nav>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Main Dashboard -->
    <section class="dashboard">
        <div class="container">
            <!-- Welcome Header -->
            <div class="dashboard-header">
                <div>
                    <h2>üëã Xin ch√†o, <span id="userName">Sinh vi√™n</span>!</h2>
                    <p style="opacity: 0.9; margin-top: 8px; font-size: 1.05rem;">Ch√†o m·ª´ng b·∫°n quay l·∫°i v·ªõi DocShare</p>
                    <p style="opacity: 0.85; margin-top: 5px; font-size: 0.95rem;" id="currentDateTime"></p>
                </div>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <a href="./upload.html" class="btn-cta-primary" style="padding: 12px 25px; font-size: 1rem;">
                        <span>‚¨ÜÔ∏è</span> T·∫£i t√†i li·ªáu l√™n
                    </a>
                    <a href="../documents/list.html" class="btn-cta-secondary" style="padding: 12px 25px; font-size: 1rem; background: rgba(255,255,255,0.2); border: 2px solid white;">
                        <span>üîç</span> Kh√°m ph√°
                    </a>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div style="font-size: 2.5rem; margin-bottom: 10px;">üìÑ</div>
                    <h3 id="myDocsCount">0</h3>
                    <p>T√†i li·ªáu c·ªßa t√¥i</p>
                </div>
                <div class="stat-card">
                    <div style="font-size: 2.5rem; margin-bottom: 10px;">üëÅÔ∏è</div>
                    <h3 id="totalViews">0</h3>
                    <p>L∆∞·ª£t xem</p>
                </div>
                <div class="stat-card">
                    <div style="font-size: 2.5rem; margin-bottom: 10px;">‚¨áÔ∏è</div>
                    <h3 id="totalDownloads">0</h3>
                    <p>L∆∞·ª£t t·∫£i</p>
                </div>
                <div class="stat-card">
                    <div style="font-size: 2.5rem; margin-bottom: 10px;">‚≠ê</div>
                    <h3 id="avgRating">0</h3>
                    <p>ƒê√°nh gi√° TB</p>
                </div>
            </div>

            <!-- Main Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Left Column -->
                <div>
                    <!-- Quick Actions -->
                    <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.07); margin-bottom: 30px;">
                        <h3 style="margin-bottom: 25px; color: #2c3e50; font-size: 1.5rem; font-weight: 700;">‚ö° Thao t√°c nhanh</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <a href="./upload.html" class="card hover-lift" style="text-decoration: none; padding: 20px; text-align: center; cursor: pointer; border: 2px solid #e9ecef;">
                                <div style="font-size: 2.5rem; margin-bottom: 8px;">‚¨ÜÔ∏è</div>
                                <h4 style="color: #2c3e50; margin-bottom: 3px; font-size: 0.95rem;">T·∫£i l√™n</h4>
                                <p style="color: #666; font-size: 0.8rem;">Chia s·∫ª t√†i li·ªáu</p>
                            </a>
                            <a href="./my-documents.html" class="card hover-lift" style="text-decoration: none; padding: 20px; text-align: center; cursor: pointer; border: 2px solid #e9ecef;">
                                <div style="font-size: 2.5rem; margin-bottom: 8px;">üìÑ</div>
                                <h4 style="color: #2c3e50; margin-bottom: 3px; font-size: 0.95rem;">Qu·∫£n l√Ω</h4>
                                <p style="color: #666; font-size: 0.8rem;">T√†i li·ªáu c·ªßa t√¥i</p>
                            </a>
                            <a href="../documents/list.html" class="card hover-lift" style="text-decoration: none; padding: 20px; text-align: center; cursor: pointer; border: 2px solid #e9ecef;">
                                <div style="font-size: 2.5rem; margin-bottom: 8px;">üîç</div>
                                <h4 style="color: #2c3e50; margin-bottom: 3px; font-size: 0.95rem;">T√¨m ki·∫øm</h4>
                                <p style="color: #666; font-size: 0.8rem;">Kh√°m ph√°</p>
                            </a>
                            <a href="./profile.html" class="card hover-lift" style="text-decoration: none; padding: 20px; text-align: center; cursor: pointer; border: 2px solid #e9ecef;">
                                <div style="font-size: 2.5rem; margin-bottom: 8px;">‚öôÔ∏è</div>
                                <h4 style="color: #2c3e50; margin-bottom: 3px; font-size: 0.95rem;">C√†i ƒë·∫∑t</h4>
                                <p style="color: #666; font-size: 0.8rem;">Th√¥ng tin</p>
                            </a>
                        </div>
                    </div>

                    <!-- My Recent Documents -->
                    <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.07); margin-bottom: 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                            <h3 style="margin: 0; color: #2c3e50; font-size: 1.5rem; font-weight: 700;">üìö T√†i li·ªáu c·ªßa t√¥i</h3>
                            <a href="./my-documents.html" style="color: #667eea; font-weight: 600; font-size: 0.9rem;">Xem t·∫•t c·∫£ ‚Üí</a>
                        </div>
                        <div id="myDocuments" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px;">
                            <!-- Documents will be loaded here -->
                            <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                                <div style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;">üì≠</div>
                                <p style="color: #666; margin-bottom: 15px;">Ch∆∞a c√≥ t√†i li·ªáu</p>
                                <a href="./upload.html" class="btn" style="width: auto; display: inline-flex;">
                                    <span>‚¨ÜÔ∏è</span> T·∫£i l√™n ngay
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div>
                    <!-- Calendar -->
                    <div class="calendar-container" style="margin-bottom: 20px;">
                        <div class="calendar-header">
                            <button onclick="previousMonth()" title="Th√°ng tr∆∞·ªõc">‚Äπ</button>
                            <h3 id="calendarMonth">Th√°ng 11, 2025</h3>
                            <button onclick="nextMonth()" title="Th√°ng sau">‚Ä∫</button>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            <div class="calendar-day header">CN</div>
                            <div class="calendar-day header">T2</div>
                            <div class="calendar-day header">T3</div>
                            <div class="calendar-day header">T4</div>
                            <div class="calendar-day header">T5</div>
                            <div class="calendar-day header">T6</div>
                            <div class="calendar-day header">T7</div>
                            <!-- Calendar days will be generated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Popular Documents (loaded from API) -->
            <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.07); margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="margin: 0; color: #2c3e50; font-size: 1.5rem; font-weight: 700;">üî• T√†i li·ªáu ph·ªï bi·∫øn</h3>
                    <a href="../documents/list.html?sort=popular" style="color: #667eea; font-weight: 600; font-size: 0.9rem;">Xem t·∫•t c·∫£ ‚Üí</a>
                </div>
                <div id="popularDocuments" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px;">
                    <p style="text-align: center; color: #666; padding: 20px; grid-column: 1 / -1;">ƒêang t·∫£i...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>üìö DocShare</h4>
                    <p>N·ªÅn t·∫£ng chia s·∫ª t√†i li·ªáu h·ªçc t·∫≠p h√†ng ƒë·∫ßu d√†nh cho sinh vi√™n Vi·ªát Nam</p>
                    <div class="footer-social">
                        <a href="#" title="Facebook">üìò</a>
                        <a href="#" title="Twitter">üê¶</a>
                        <a href="#" title="Instagram">üì∑</a>
                        <a href="#" title="LinkedIn">üíº</a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Li√™n k·∫øt nhanh</h4>
                    <ul>
                        <li><a href="./home.html">Dashboard</a></li>
                        <li><a href="./my-documents.html">T√†i li·ªáu c·ªßa t√¥i</a></li>
                        <li><a href="./upload.html">T·∫£i l√™n</a></li>
                        <li><a href="./profile.html">C√†i ƒë·∫∑t</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>H·ªó tr·ª£</h4>
                    <ul>
                        <li><a href="../help.html">Trung t√¢m tr·ª£ gi√∫p</a></li>
                        <li><a href="../contact.html">Li√™n h·ªá</a></li>
                        <li><a href="../faq.html">FAQ</a></li>
                        <li><a href="../feedback.html">G√≥p √Ω</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Ph√°p l√Ω</h4>
                    <ul>
                        <li><a href="../terms.html">ƒêi·ªÅu kho·∫£n</a></li>
                        <li><a href="../privacy.html">B·∫£o m·∫≠t</a></li>
                        <li><a href="../copyright.html">B·∫£n quy·ªÅn</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 DocShare. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Back to Top -->
    <button id="backToTop" class="back-to-top" onclick="scrollToTop()">‚Üë</button>

    <!-- Scripts -->
    <script src="../main.js"></script>
    <script src="../header-auth.js"></script>
    <script>
        // Global variables
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        const monthNames = ["Th√°ng 1", "Th√°ng 2", "Th√°ng 3", "Th√°ng 4", "Th√°ng 5", "Th√°ng 6",
            "Th√°ng 7", "Th√°ng 8", "Th√°ng 9", "Th√°ng 10", "Th√°ng 11", "Th√°ng 12"
        ];

        // Check authentication on page load
        window.addEventListener('DOMContentLoaded', function() {
            checkAuthAndLoadData();
            updateDateTime();
            setInterval(updateDateTime, 60000); // Update every minute
            generateCalendar();
        });

        // Update current date time
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            const dateTimeStr = now.toLocaleDateString('vi-VN', options);
            const dateTimeEl = document.getElementById('currentDateTime');
            if (dateTimeEl) {
                dateTimeEl.textContent = dateTimeStr;
            }
        }

        // Check authentication and load dashboard data
        async function checkAuthAndLoadData() {
            const user = getUser();
            const token = getToken();

            if (!user || !token) {
                showToast('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c', 'info');
                setTimeout(() => {
                    window.location.href = '../login.html';
                }, 1500);
                return;
            }

            // Update user info in header
            updateUserInfo(user);

            // Load dashboard data
            await loadDashboardStats();
            await loadMyDocuments();
            await loadPopularDocuments();
            
            // Animate progress bars after load
            setTimeout(() => {
                animateProgressBars();
            }, 500);
        }

        // Update user information in UI
        function updateUserInfo(user) {
            const userName = document.getElementById('userName');
            const userNameHeader = document.getElementById('userNameHeader');
            const dropdownUserEmail = document.getElementById('dropdownUserEmail');

            if (userName) {
                const displayName = user.ho_ten || user.email.split('@')[0];
                userName.textContent = displayName;
            }

            if (userNameHeader) {
                const displayName = user.ho_ten || user.email.split('@')[0];
                userNameHeader.textContent = displayName.length > 20 ? displayName.substring(0, 20) + '...' : displayName;
            }

            if (dropdownUserEmail) {
                dropdownUserEmail.textContent = user.email;
            }
        }

        // Load dashboard statistics
        async function loadDashboardStats() {
            try {
                const response = await apiGet('/users/me/stats');
                
                if (response && response.ok) {
                    const stats = await response.json();
                    
                    // Update stat cards with real data from API
                    animateValue('myDocsCount', 0, stats.documents || 0, 1000);
                    animateValue('totalViews', 0, stats.views || 0, 1000);
                    animateValue('totalDownloads', 0, stats.downloads || 0, 1000);
                    
                    const avgRating = parseFloat(stats.rating) || 0;
                    document.getElementById('avgRating').textContent = avgRating.toFixed(1);
                    
                    // Study streak (kh√¥ng c√≥ trong API, ƒë·ªÉ m·∫∑c ƒë·ªãnh)
                    animateValue('studyStreak', 0, 7, 1500);
                } else {
                    // Show 0 if API fails or user has no documents
                    showEmptyStats();
                }
            } catch (error) {
                console.error('Error loading stats:', error);
                showEmptyStats();
            }
        }

        // Show empty statistics (all zeros)
        function showEmptyStats() {
            document.getElementById('myDocsCount').textContent = '0';
            document.getElementById('totalViews').textContent = '0';
            document.getElementById('totalDownloads').textContent = '0';
            document.getElementById('avgRating').textContent = '0.0';
            document.getElementById('studyStreak').textContent = '0';
            
            // Monthly stats
            const monthlyDocs = Math.floor(randomDocs * 0.3);
            const monthlyViews = Math.floor(randomViews * 0.4);
            const monthlyDownloads = Math.floor(randomDownloads * 0.4);
            
            document.getElementById('monthlyDocs').textContent = monthlyDocs;
            document.getElementById('monthlyViews').textContent = monthlyViews;
            document.getElementById('monthlyDownloads').textContent = monthlyDownloads;
            
            animateValue('studyStreak', 0, 7, 1500);
        }

        // Animate number count up
        function animateValue(id, start, end, duration) {
            const element = document.getElementById(id);
            if (!element) return;
            
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current);
            }, 16);
        }

        // Animate progress bars
        function animateProgressBars() {
            const progressBars = document.querySelectorAll('.progress-bar');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.width = width;
                }, 100);
            });
        }

        // Load my documents
        async function loadMyDocuments() {
            const container = document.getElementById('myDocuments');
            if (!container) return;
            
            try {
                const response = await apiGet('/documents/my-documents?limit=4');
                
                if (response && response.ok) {
                    const data = await response.json();
                    const documents = data.documents || data;
                    
                    if (documents && documents.length > 0) {
                        container.innerHTML = documents.map(doc => createMiniDocumentCard(doc)).join('');
                    } else {
                        // Keep empty state with upload button
                    }
                } else {
                    // Keep empty state or show error
                }
            } catch (error) {
                console.error('Error loading my documents:', error);
            }
        }

        // Load popular documents
        async function loadPopularDocuments() {
            const container = document.getElementById('popularDocuments');
            if (!container) return;
            
            try {
                const response = await apiGet('/documents/popular?limit=4');
                
                if (response && response.ok) {
                    const documents = await response.json();
                    
                    if (documents && documents.length > 0) {
                        container.innerHTML = documents.map(doc => createMiniDocumentCard(doc)).join('');
                    } else {
                        container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px; grid-column: 1 / -1;">Ch∆∞a c√≥ t√†i li·ªáu ph·ªï bi·∫øn</p>';
                    }
                } else {
                    container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px; grid-column: 1 / -1;">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu</p>';
                }
            } catch (error) {
                console.error('Error loading popular documents:', error);
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px; grid-column: 1 / -1;">L·ªói k·∫øt n·ªëi</p>';
            }
        }

        // Create mini document card
        function createMiniDocumentCard(doc) {
            const colors = ['#667eea', '#27ae60', '#e74c3c', '#f39c12', '#3498db', '#9b59b6'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            return `
                <div class="recommendation-card" onclick="window.location.href='../documents/detail.html?id=${doc.ma_tai_lieu || doc.id}'">
                    <div class="recommendation-image" style="background: linear-gradient(135deg, ${randomColor} 0%, ${randomColor}dd 100%);">
                        üìÑ
                    </div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">${doc.tieu_de || doc.title}</div>
                        <div class="recommendation-meta">
                            <span>üëÅÔ∏è ${formatNumber(doc.so_luot_xem || doc.views || 0)}</span>
                            <span>‚≠ê ${doc.rating || '-'}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Calendar functions
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            if (!calendarGrid) return;
            
            // Update month display with animation
            const monthEl = document.getElementById('calendarMonth');
            monthEl.style.opacity = '0';
            setTimeout(() => {
                monthEl.textContent = `${monthNames[currentMonth]}, ${currentYear}`;
                monthEl.style.transition = 'opacity 0.3s ease';
                monthEl.style.opacity = '1';
            }, 150);
            
            // Get first day of month and number of days
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const today = new Date();
            
            // Clear existing days (keep headers)
            const headers = Array.from(calendarGrid.children).slice(0, 7);
            calendarGrid.innerHTML = '';
            headers.forEach(header => calendarGrid.appendChild(header));
            
            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day inactive';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Add days of month with staggered animation
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                dayEl.textContent = day;
                dayEl.style.opacity = '0';
                dayEl.style.transform = 'scale(0.8)';
                
                // Check if today
                if (currentYear === today.getFullYear() && 
                    currentMonth === today.getMonth() && 
                    day === today.getDate()) {
                    dayEl.classList.add('today');
                }
                
                // Check if weekend (Sunday = 0, Saturday = 6)
                const dayOfWeek = new Date(currentYear, currentMonth, day).getDay();
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    dayEl.style.color = '#e74c3c';
                }
                
                calendarGrid.appendChild(dayEl);
                
                // Animate in with delay
                setTimeout(() => {
                    dayEl.style.transition = 'all 0.3s ease';
                    dayEl.style.opacity = '1';
                    dayEl.style.transform = 'scale(1)';
                }, day * 15);
            }
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar();
        }

        // Toggle user dropdown
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdownMenu');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('userDropdownMenu');
            const dropdownBtn = document.querySelector('.user-dropdown-btn');
            
            if (dropdown && dropdownBtn) {
                if (!dropdown.contains(e.target) && !dropdownBtn.contains(e.target)) {
                    dropdown.classList.remove('show');
                }
            }
        });

        // Toggle mobile menu
        function toggleMobileMenu() {
            const nav = document.querySelector('.nav');
            if (nav) {
                nav.classList.toggle('active');
            }
        }

        // Format number helper
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Notification click handlers
        document.addEventListener('DOMContentLoaded', function() {
            const notificationItems = document.querySelectorAll('.notification-item');
            notificationItems.forEach(item => {
                item.addEventListener('click', function() {
                    this.classList.remove('notification-unread');
                    // Handle notification click
                    showToast('ƒê√£ ƒë√°nh d·∫•u l√† ƒë√£ ƒë·ªçc', 'success');
                });
            });
        });

        // Auto-refresh data every 5 minutes
        setInterval(() => {
            loadDashboardStats();
        }, 300000);

        // Add smooth scroll behavior
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="C√†i ƒë·∫∑t t√†i kho·∫£n - DocShare">
    <title>C√†i ƒë·∫∑t t√†i kho·∫£n - DocShare</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
    <style>
        /* Profile Page Styles */
        .profile-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .profile-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        /* Sidebar Navigation */
        .profile-sidebar {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            height: fit-content;
            position: sticky;
            top: 90px;
        }

        .profile-nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 18px;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #555;
            font-weight: 600;
            text-decoration: none;
        }

        .profile-nav-item:hover {
            background: linear-gradient(135deg, #f0f4ff 0%, #e8f0fe 100%);
            color: #667eea;
            transform: translateX(5px);
        }

        .profile-nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .profile-nav-icon {
            font-size: 1.3rem;
        }

        /* Main Content */
        .profile-content {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            min-height: 600px;
        }

        .profile-section {
            display: none;
        }

        .profile-section.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-title {
            font-size: 1.8rem;
            color: #2c3e50;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-subtitle {
            color: #666;
            font-size: 0.95rem;
            margin-top: 5px;
        }

        /* Avatar Section */
        .avatar-section {
            display: flex;
            align-items: center;
            gap: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .avatar-container {
            position: relative;
        }

        .avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            font-weight: 700;
            border: 5px solid white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            object-fit: cover;
        }

        .avatar-upload-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 3px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }

        .avatar-upload-btn:hover {
            transform: scale(1.1);
        }

        .avatar-upload-btn input {
            display: none;
        }

        .avatar-info {
            flex: 1;
        }

        .avatar-name {
            font-size: 1.5rem;
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .avatar-email {
            color: #666;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .avatar-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Form Styles */
        .profile-form {
            display: grid;
            gap: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row-full {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
            margin-top: 30px;
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 8px 20px;
            font-size: 0.9rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Settings Items */
        .settings-group {
            margin-bottom: 30px;
        }

        .settings-group-title {
            font-size: 1.2rem;
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .setting-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .setting-info {
            flex: 1;
        }

        .setting-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .setting-description {
            color: #666;
            font-size: 0.85rem;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ccc;
            border-radius: 30px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        /* Activity Log */
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .activity-item {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .activity-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .activity-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .activity-time {
            color: #999;
            font-size: 0.85rem;
        }

        /* Password Strength */
        .password-strength {
            height: 5px;
            background: #e9ecef;
            border-radius: 5px;
            margin-top: 8px;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
            border-radius: 5px;
        }

        .password-strength-bar.weak {
            width: 33%;
            background: #e74c3c;
        }

        .password-strength-bar.medium {
            width: 66%;
            background: #f39c12;
        }

        .password-strength-bar.strong {
            width: 100%;
            background: #27ae60;
        }

        .password-requirements {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .password-requirement {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 0;
            font-size: 0.85rem;
        }

        .password-requirement.met {
            color: #27ae60;
        }

        .password-requirement.not-met {
            color: #999;
        }

        /* Danger Zone */
        .danger-zone {
            background: linear-gradient(135deg, #fee 0%, #fdd 100%);
            border: 2px solid #e74c3c;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }

        .danger-zone-title {
            color: #e74c3c;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .danger-zone-content {
            color: #c0392b;
            margin-bottom: 20px;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .modal-body {
            margin-bottom: 30px;
            color: #666;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Responsive */
        @media (max-width: 968px) {
            .profile-layout {
                grid-template-columns: 1fr;
            }

            .profile-sidebar {
                position: static;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .avatar-section {
                flex-direction: column;
                text-align: center;
            }

            .avatar-actions {
                justify-content: center;
            }

            .form-actions {
                flex-direction: column;
            }

            .form-actions .btn {
                width: 100%;
                justify-content: center;
            }

            .profile-content {
                padding: 25px 20px;
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .setting-item {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .activity-item {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>ƒêang x·ª≠ l√Ω...</p>
    </div>

    <!-- Notification Toast -->
    <div id="notificationToast" class="notification-toast">
        <span id="toastMessage"></span>
        <button onclick="closeToast()" class="toast-close">&times;</button>
    </div>

    <!-- Delete Account Modal -->
    <div id="deleteAccountModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">‚ö†Ô∏è X√°c nh·∫≠n x√≥a t√†i kho·∫£n</div>
            <div class="modal-body">
                <p style="margin-bottom: 15px;">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i kho·∫£n? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</p>
                <p style="font-weight: 600; color: #e74c3c;">T·∫•t c·∫£ d·ªØ li·ªáu v√† t√†i li·ªáu c·ªßa b·∫°n s·∫Ω b·ªã x√≥a vƒ©nh vi·ªÖn.</p>
                <div class="form-group" style="margin-top: 20px;">
                    <label>Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ x√°c nh·∫≠n:</label>
                    <input type="password" id="deleteConfirmPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u c·ªßa b·∫°n">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">H·ªßy</button>
                <button class="btn btn-danger" onclick="confirmDeleteAccount()">
                    <span>üóëÔ∏è</span> X√≥a t√†i kho·∫£n
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <a href="../index.html" style="text-decoration: none; color: inherit;">
                    <h1>üìö DocShare</h1>
                </a>
                <span class="logo-subtitle">H·ªçc t·∫≠p & Chia s·∫ª</span>
            </div>
            <nav class="nav">
                <a href="../index.html" class="nav-link">
                    <span class="nav-icon">üè†</span>
                    Trang ch·ªß
                </a>
                <a href="../documents/list.html" class="nav-link">
                    <span class="nav-icon">üîç</span>
                    Kh√°m ph√°
                </a>
                <a href="../features.html" class="nav-link">
                    <span class="nav-icon">‚ú®</span>
                    T√≠nh nƒÉng
                </a>
                <a href="../about.html" class="nav-link">
                    <span class="nav-icon">‚ÑπÔ∏è</span>
                    V·ªÅ ch√∫ng t√¥i
                </a>
                <div class="nav-buttons" id="authButtons" style="display: none;">
                    <a href="../login.html" class="btn-login">
                        <span>üîë</span> ƒêƒÉng nh·∫≠p
                    </a>
                    <a href="../register.html" class="btn-register">
                        <span>üìù</span> ƒêƒÉng k√Ω
                    </a>
                </div>
                <!-- User Dropdown (ch·ªâ hi·ªán khi ƒë√£ ƒëƒÉng nh·∫≠p) -->
                <div class="nav-buttons" id="userSection">
                    <a href="../admin/dashboard.html" id="adminLink" class="btn-danger" style="display: none;">
                        <span>üîë</span> Qu·∫£n tr·ªã
                    </a>
                    <div class="user-dropdown">
                        <button class="user-dropdown-btn" onclick="toggleUserDropdown()">
                            <span class="user-icon">üë§</span>
                            <span id="userNameHeader">Ng∆∞·ªùi d√πng</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </button>
                        <div class="user-dropdown-menu" id="userDropdownMenu">
                            <div class="dropdown-header">
                                <span class="user-icon">üë§</span>
                                <span id="dropdownUserEmail" style="margin-left: 8px;">email@example.com</span>
                            </div>
                            <div class="dropdown-content-grid">
                                <a href="./home.html" class="dropdown-item">
                                    <span class="dropdown-icon">üìä</span>
                                    <span>Dashboard</span>
                                </a>
                                <a href="./my-documents.html" class="dropdown-item">
                                    <span class="dropdown-icon">üìÑ</span>
                                    <span>T√†i li·ªáu c·ªßa t√¥i</span>
                                </a>
                                <a href="./upload.html" class="dropdown-item">
                                    <span class="dropdown-icon">‚¨ÜÔ∏è</span>
                                    <span>T·∫£i l√™n</span>
                                </a>
                                <a href="./profile.html" class="dropdown-item">
                                    <span class="dropdown-icon">‚öôÔ∏è</span>
                                    <span>C√†i ƒë·∫∑t</span>
                                </a>
                            </div>
                            <div class="dropdown-divider"></div>
                            <button onclick="logout()" class="dropdown-item dropdown-logout">
                                <span class="dropdown-icon">üö™</span>
                                <span>ƒêƒÉng xu·∫•t</span>
                            </button>
                        </div>
                    </div>
                </div>
            </nav>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <section class="dashboard">
        <div class="container profile-container">
            <!-- Page Header -->
            <div class="dashboard-header">
                <div>
                    <h2>‚öôÔ∏è C√†i ƒë·∫∑t t√†i kho·∫£n</h2>
                    <p style="opacity: 0.9; margin-top: 8px; font-size: 1.05rem;">Qu·∫£n l√Ω th√¥ng tin c√° nh√¢n v√† c√†i ƒë·∫∑t c·ªßa b·∫°n</p>
                </div>
            </div>

            <!-- Profile Layout -->
            <div class="profile-layout">
                <!-- Sidebar -->
                <aside class="profile-sidebar">
                    <div class="profile-nav-item active" onclick="showSection('personal-info')" data-section="personal-info">
                        <span class="profile-nav-icon">üë§</span>
                        <span>Th√¥ng tin c√° nh√¢n</span>
                    </div>
                    <div class="profile-nav-item" onclick="showSection('password')" data-section="password">
                        <span class="profile-nav-icon">üîí</span>
                        <span>ƒê·ªïi m·∫≠t kh·∫©u</span>
                    </div>
                    <div class="profile-nav-item" onclick="showSection('stats')" data-section="stats">
                        <span class="profile-nav-icon">üìä</span>
                        <span>Th·ªëng k√™</span>
                    </div>
                    <div class="profile-nav-item" onclick="showSection('notifications')" data-section="notifications">
                        <span class="profile-nav-icon">üîî</span>
                        <span>Th√¥ng b√°o</span>
                    </div>
                    <div class="profile-nav-item" onclick="showSection('privacy')" data-section="privacy">
                        <span class="profile-nav-icon">üîê</span>
                        <span>Quy·ªÅn ri√™ng t∆∞</span>
                    </div>
                    <div class="profile-nav-item" onclick="showSection('activity')" data-section="activity">
                        <span class="profile-nav-icon">üìú</span>
                        <span>Ho·∫°t ƒë·ªông</span>
                    </div>
                    <div class="profile-nav-item" onclick="showSection('account')" data-section="account">
                        <span class="profile-nav-icon">‚ö†Ô∏è</span>
                        <span>T√†i kho·∫£n</span>
                    </div>
                </aside>

                <!-- Main Content -->
                <main class="profile-content">
                    <!-- Personal Info Section -->
                    <div class="profile-section active" id="section-personal-info">
                        <div class="section-header">
                            <div>
                                <h2 class="section-title">
                                    <span>üë§</span>
                                    Th√¥ng tin c√° nh√¢n
                                </h2>
                                <p class="section-subtitle">C·∫≠p nh·∫≠t th√¥ng tin c·ªßa b·∫°n</p>
                            </div>
                        </div>

                        <!-- Avatar Section -->
                        <div class="avatar-section">
                            <div class="avatar-container">
                                <img id="userAvatar" class="avatar-large" src="" alt="Avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="avatar-large" id="avatarPlaceholder" style="display: none;">
                                    <span id="avatarInitials">U</span>
                                </div>
                                <label class="avatar-upload-btn" title="Thay ƒë·ªïi ·∫£nh ƒë·∫°i di·ªán">
                                    <span>üì∑</span>
                                    <input type="file" accept="image/*" onchange="handleAvatarUpload(event)">
                                </label>
                            </div>
                            <div class="avatar-info">
                                <div class="avatar-name" id="displayName">Ng∆∞·ªùi d√πng</div>
                                <div class="avatar-email" id="displayEmail">email@example.com</div>
                                <div class="avatar-actions">
                                    <span class="badge badge-success">ƒê√£ x√°c th·ª±c email</span>
                                    <span class="badge badge-info" id="memberSince">Th√†nh vi√™n t·ª´ 2025</span>
                                </div>
                            </div>
                        </div>

                        <!-- Personal Info Form -->
                        <form class="profile-form" id="personalInfoForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="firstName">H·ªç *</label>
                                    <input type="text" id="firstName" required placeholder="Nh·∫≠p h·ªç c·ªßa b·∫°n">
                                </div>
                                <div class="form-group">
                                    <label for="lastName">T√™n *</label>
                                    <input type="text" id="lastName" required placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="email">Email *</label>
                                    <input type="email" id="email" required placeholder="email@example.com" readonly style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label for="phone">S·ªë ƒëi·ªán tho·∫°i</label>
                                    <input type="tel" id="phone" placeholder="0123456789">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="university">Tr∆∞·ªùng</label>
                                    <input type="text" id="university" placeholder="T√™n tr∆∞·ªùng ƒë·∫°i h·ªçc">
                                </div>
                                <div class="form-group">
                                    <label for="major">Chuy√™n ng√†nh</label>
                                    <input type="text" id="major" placeholder="Chuy√™n ng√†nh c·ªßa b·∫°n">
                                </div>
                            </div>

                            <div class="form-group form-row-full">
                                <label for="bio">Gi·ªõi thi·ªáu b·∫£n th√¢n</label>
                                <textarea id="bio" placeholder="Vi·∫øt v√†i d√≤ng gi·ªõi thi·ªáu v·ªÅ b·∫£n th√¢n..."></textarea>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="resetPersonalInfo()">
                                    <span>‚Ü∫</span> ƒê·∫∑t l·∫°i
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <span>üíæ</span> L∆∞u thay ƒë·ªïi
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Password Section -->
                    <div class="profile-section" id="section-password">
                        <div class="section-header">
                            <div>
                                <h2 class="section-title">
                                    <span>üîí</span>
                                    ƒê·ªïi m·∫≠t kh·∫©u
                                </h2>
                                <p class="section-subtitle">C·∫≠p nh·∫≠t m·∫≠t kh·∫©u ƒë·ªÉ b·∫£o m·∫≠t t√†i kho·∫£n</p>
                            </div>
                        </div>

                        <form class="profile-form" id="passwordForm" style="max-width: 600px;">
                            <div class="form-group">
                                <label for="currentPassword">M·∫≠t kh·∫©u hi·ªán t·∫°i *</label>
                                <input type="password" id="currentPassword" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i">
                            </div>

                            <div class="form-group">
                                <label for="newPassword">M·∫≠t kh·∫©u m·ªõi *</label>
                                <input type="password" id="newPassword" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi" oninput="checkPasswordStrength()">
                                <div class="password-strength">
                                    <div class="password-strength-bar" id="passwordStrengthBar"></div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="confirmPassword">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi *</label>
                                <input type="password" id="confirmPassword" required placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
                            </div>

                            <div class="password-requirements">
                                <strong style="display: block; margin-bottom: 10px;">Y√™u c·∫ßu m·∫≠t kh·∫©u:</strong>
                                <div class="password-requirement not-met" id="req-length">
                                    <span>‚óã</span> √çt nh·∫•t 8 k√Ω t·ª±
                                </div>
                                <div class="password-requirement not-met" id="req-uppercase">
                                    <span>‚óã</span> C√≥ √≠t nh·∫•t 1 ch·ªØ hoa
                                </div>
                                <div class="password-requirement not-met" id="req-lowercase">
                                    <span>‚óã</span> C√≥ √≠t nh·∫•t 1 ch·ªØ th∆∞·ªùng
                                </div>
                                <div class="password-requirement not-met" id="req-number">
                                    <span>‚óã</span> C√≥ √≠t nh·∫•t 1 s·ªë
                                </div>
                                <div class="password-requirement not-met" id="req-special">
                                    <span>‚óã</span> C√≥ √≠t nh·∫•t 1 k√Ω t·ª± ƒë·∫∑c bi·ªát
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="document.getElementById('passwordForm').reset(); checkPasswordStrength();">
                                    <span>‚Ü∫</span> ƒê·∫∑t l·∫°i
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <span>üîí</span> ƒê·ªïi m·∫≠t kh·∫©u
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Stats Section -->
                    <div class="profile-section" id="section-stats">
                        <div class="section-header">
                            <div>
                                <h2 class="section-title">
                                    <span>üìä</span>
                                    Th·ªëng k√™ t√†i kho·∫£n
                                </h2>
                                <p class="section-subtitle">Xem ho·∫°t ƒë·ªông v√† ƒë√≥ng g√≥p c·ªßa b·∫°n</p>
                            </div>
                        </div>

                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">üìÑ</div>
                                <div class="stat-value" id="statDocuments">0</div>
                                <div class="stat-label">T√†i li·ªáu ƒë√£ t·∫£i l√™n</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üëÅÔ∏è</div>
                                <div class="stat-value" id="statViews">0</div>
                                <div class="stat-label">L∆∞·ª£t xem</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">‚¨áÔ∏è</div>
                                <div class="stat-value" id="statDownloads">0</div>
                                <div class="stat-label">L∆∞·ª£t t·∫£i xu·ªëng</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">‚ù§Ô∏è</div>
                                <div class="stat-value" id="statLikes">0</div>
                                <div class="stat-label">L∆∞·ª£t th√≠ch</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üí¨</div>
                                <div class="stat-value" id="statComments">0</div>
                                <div class="stat-label">B√¨nh lu·∫≠n</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">‚≠ê</div>
                                <div class="stat-value" id="statRating">0.0</div>
                                <div class="stat-label">ƒê√°nh gi√° trung b√¨nh</div>
                            </div>
                        </div>

                        <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 25px; border-radius: 12px; border-left: 4px solid #2196F3;">
                            <h4 style="color: #1976D2; margin-bottom: 15px; font-weight: 700;">üèÜ Th√†nh t√≠ch</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 15px;">
                                <span class="badge badge-success" style="font-size: 0.9rem; padding: 8px 15px;">üåü Th√†nh vi√™n t√≠ch c·ª±c</span>
                                <span class="badge badge-info" style="font-size: 0.9rem; padding: 8px 15px;">üìö Ng∆∞·ªùi ƒë√≥ng g√≥p</span>
                                <span class="badge badge-warning" style="font-size: 0.9rem; padding: 8px 15px;">üî• 10+ t√†i li·ªáu</span>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Section -->
                    <div class="profile-section" id="section-notifications">
                        <div class="section-header">
                            <div>
                                <h2 class="section-title">
                                    <span>üîî</span>
                                    C√†i ƒë·∫∑t th√¥ng b√°o
                                </h2>
                                <p class="section-subtitle">Qu·∫£n l√Ω c√°c th√¥ng b√°o b·∫°n mu·ªën nh·∫≠n</p>
                            </div>
                        </div>

                        <div class="settings-group">
                            <div class="settings-group-title">
                                <span>üìß</span> Th√¥ng b√°o qua Email
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">T√†i li·ªáu ƒë∆∞·ª£c ph√™ duy·ªát</div>
                                    <div class="setting-description">Nh·∫≠n th√¥ng b√°o khi t√†i li·ªáu c·ªßa b·∫°n ƒë∆∞·ª£c ph√™ duy·ªát</div>
                                </div>
                                <div class="toggle-switch active" onclick="toggleSetting(this, 'email_approved')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">B√¨nh lu·∫≠n m·ªõi</div>
                                    <div class="setting-description">Nh·∫≠n th√¥ng b√°o khi c√≥ ng∆∞·ªùi b√¨nh lu·∫≠n t√†i li·ªáu c·ªßa b·∫°n</div>
                                </div>
                                <div class="toggle-switch active" onclick="toggleSetting(this, 'email_comments')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">Th√≠ch t√†i li·ªáu</div>
                                    <div class="setting-description">Nh·∫≠n th√¥ng b√°o khi c√≥ ng∆∞·ªùi th√≠ch t√†i li·ªáu c·ªßa b·∫°n</div>
                                </div>
                                <div class="toggle-switch" onclick="toggleSetting(this, 'email_likes')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">Tin t·ª©c & c·∫≠p nh·∫≠t</div>
                                    <div class="setting-description">Nh·∫≠n th√¥ng tin v·ªÅ t√≠nh nƒÉng m·ªõi v√† c·∫≠p nh·∫≠t</div>
                                </div>
                                <div class="toggle-switch active" onclick="toggleSetting(this, 'email_newsletter')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-group">
                            <div class="settings-group-title">
                                <span>üîî</span> Th√¥ng b√°o tr√™n web
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">Th√¥ng b√°o tr·ª±c ti·∫øp</div>
                                    <div class="setting-description">Hi·ªÉn th·ªã th√¥ng b√°o ngay tr√™n website</div>
                                </div>
                                <div class="toggle-switch active" onclick="toggleSetting(this, 'web_notifications')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">√Çm thanh th√¥ng b√°o</div>
                                    <div class="setting-description">Ph√°t √¢m thanh khi c√≥ th√¥ng b√°o m·ªõi</div>
                                </div>
                                <div class="toggle-switch" onclick="toggleSetting(this, 'notification_sound')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="saveNotificationSettings()">
                                <span>üíæ</span> L∆∞u c√†i ƒë·∫∑t
                            </button>
                        </div>
                    </div>

                    <!-- Privacy Section -->
                    <div class="profile-section" id="section-privacy">
                        <div class="section-header">
                            <div>
                                <h2 class="section-title">
                                    <span>üîê</span>
                                    Quy·ªÅn ri√™ng t∆∞
                                </h2>
                                <p class="section-subtitle">Ki·ªÉm so√°t ai c√≥ th·ªÉ xem th√¥ng tin c·ªßa b·∫°n</p>
                            </div>
                        </div>

                        <div class="settings-group">
                            <div class="settings-group-title">
                                <span>üë•</span> H·ªì s∆° c√¥ng khai
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">Hi·ªÉn th·ªã h·ªì s∆° c√¥ng khai</div>
                                    <div class="setting-description">Cho ph√©p ng∆∞·ªùi kh√°c xem h·ªì s∆° c·ªßa b·∫°n</div>
                                </div>
                                <div class="toggle-switch active" onclick="toggleSetting(this, 'public_profile')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">Hi·ªÉn th·ªã email</div>
                                    <div class="setting-description">Hi·ªÉn th·ªã email tr√™n h·ªì s∆° c√¥ng khai</div>
                                </div>
                                <div class="toggle-switch" onclick="toggleSetting(this, 'show_email')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">Hi·ªÉn th·ªã s·ªë ƒëi·ªán tho·∫°i</div>
                                    <div class="setting-description">Hi·ªÉn th·ªã s·ªë ƒëi·ªán tho·∫°i tr√™n h·ªì s∆° c√¥ng khai</div>
                                </div>
                                <div class="toggle-switch" onclick="toggleSetting(this, 'show_phone')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-group">
                            <div class="settings-group-title">
                                <span>üìÑ</span> T√†i li·ªáu
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">Cho ph√©p b√¨nh lu·∫≠n</div>
                                    <div class="setting-description">Ng∆∞·ªùi kh√°c c√≥ th·ªÉ b√¨nh lu·∫≠n v√†o t√†i li·ªáu c·ªßa b·∫°n</div>
                                </div>
                                <div class="toggle-switch active" onclick="toggleSetting(this, 'allow_comments')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">Hi·ªÉn th·ªã th·ªëng k√™</div>
                                    <div class="setting-description">Hi·ªÉn th·ªã s·ªë l∆∞·ª£t xem, t·∫£i xu·ªëng c√¥ng khai</div>
                                </div>
                                <div class="toggle-switch active" onclick="toggleSetting(this, 'show_stats')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="savePrivacySettings()">
                                <span>üíæ</span> L∆∞u c√†i ƒë·∫∑t
                            </button>
                        </div>
                    </div>

                    <!-- Activity Section -->
                    <div class="profile-section" id="section-activity">
                        <div class="section-header">
                            <div>
                                <h2 class="section-title">
                                    <span>üìú</span>
                                    L·ªãch s·ª≠ ho·∫°t ƒë·ªông
                                </h2>
                                <p class="section-subtitle">Theo d√µi c√°c ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y c·ªßa b·∫°n</p>
                            </div>
                            <button class="btn btn-secondary btn-small" onclick="clearActivityLog()">
                                <span>üóëÔ∏è</span> X√≥a l·ªãch s·ª≠
                            </button>
                        </div>

                        <div class="activity-list" id="activityList">
                            <!-- Activity items will be loaded here -->
                        </div>
                    </div>

                    <!-- Account Section -->
                    <div class="profile-section" id="section-account">
                        <div class="section-header">
                            <div>
                                <h2 class="section-title">
                                    <span>‚öôÔ∏è</span>
                                    Qu·∫£n l√Ω t√†i kho·∫£n
                                </h2>
                                <p class="section-subtitle">C√†i ƒë·∫∑t v√† qu·∫£n l√Ω t√†i kho·∫£n c·ªßa b·∫°n</p>
                            </div>
                        </div>

                        <div class="settings-group">
                            <div class="settings-group-title">
                                <span>üîê</span> B·∫£o m·∫≠t
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">X√°c th·ª±c hai y·∫øu t·ªë (2FA)</div>
                                    <div class="setting-description">Th√™m l·ªõp b·∫£o m·∫≠t cho t√†i kho·∫£n c·ªßa b·∫°n</div>
                                </div>
                                <button class="btn btn-secondary btn-small" onclick="setup2FA()">
                                    Thi·∫øt l·∫≠p
                                </button>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">Phi√™n ƒëƒÉng nh·∫≠p</div>
                                    <div class="setting-description">Qu·∫£n l√Ω c√°c thi·∫øt b·ªã ƒëang ƒëƒÉng nh·∫≠p</div>
                                </div>
                                <button class="btn btn-secondary btn-small" onclick="manageSessions()">
                                    Xem chi ti·∫øt
                                </button>
                            </div>
                        </div>

                        <div class="settings-group">
                            <div class="settings-group-title">
                                <span>üíæ</span> D·ªØ li·ªáu
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">Xu·∫•t d·ªØ li·ªáu</div>
                                    <div class="setting-description">T·∫£i xu·ªëng b·∫£n sao d·ªØ li·ªáu c·ªßa b·∫°n</div>
                                </div>
                                <button class="btn btn-secondary btn-small" onclick="exportData()">
                                    <span>‚¨áÔ∏è</span> Xu·∫•t
                                </button>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-title">Sao l∆∞u t√†i kho·∫£n</div>
                                    <div class="setting-description">T·∫°o b·∫£n sao l∆∞u ho√†n ch·ªânh</div>
                                </div>
                                <button class="btn btn-secondary btn-small" onclick="backupAccount()">
                                    <span>üíæ</span> Sao l∆∞u
                                </button>
                            </div>
                        </div>

                        <!-- Danger Zone -->
                        <div class="danger-zone">
                            <div class="danger-zone-title">
                                <span>‚ö†Ô∏è</span> V√πng nguy hi·ªÉm
                            </div>
                            <div class="danger-zone-content">
                                <p><strong>X√≥a t√†i kho·∫£n:</strong> H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c. T·∫•t c·∫£ d·ªØ li·ªáu c·ªßa b·∫°n s·∫Ω b·ªã x√≥a vƒ©nh vi·ªÖn.</p>
                            </div>
                            <button class="btn btn-danger" onclick="openDeleteModal()">
                                <span>üóëÔ∏è</span> X√≥a t√†i kho·∫£n
                            </button>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>üìö DocShare</h4>
                    <p>N·ªÅn t·∫£ng chia s·∫ª t√†i li·ªáu h·ªçc t·∫≠p h√†ng ƒë·∫ßu d√†nh cho sinh vi√™n Vi·ªát Nam</p>
                </div>
                <div class="footer-section">
                    <h4>Li√™n k·∫øt nhanh</h4>
                    <ul>
                        <li><a href="./home.html">Dashboard</a></li>
                        <li><a href="./my-documents.html">T√†i li·ªáu c·ªßa t√¥i</a></li>
                        <li><a href="./upload.html">T·∫£i l√™n</a></li>
                        <li><a href="./profile.html">C√†i ƒë·∫∑t</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 DocShare. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Back to Top -->
    <button id="backToTop" class="back-to-top" onclick="scrollToTop()">‚Üë</button>

    <!-- Scripts -->
    <script src="../main.js"></script>
    <script src="../header-auth.js"></script>
    <script>
        // ============================================================================
        // GLOBAL VARIABLES
        // ============================================================================
        let currentUser = null;
        let notificationSettings = {};
        let privacySettings = {};

        // ============================================================================
        // INITIALIZATION
        // ============================================================================
        window.addEventListener('DOMContentLoaded', function() {
            checkAuthAndInit();
            loadUserData();
            loadActivityLog();
        });

        function checkAuthAndInit() {
            currentUser = getUser();
            const token = getToken();

            if (!currentUser || !token) {
                showToast('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem trang n√†y', 'info');
                setTimeout(() => {
                    window.location.href = '../login.html?redirect=profile';
                }, 1500);
                return;
            }

            updateUserInfo(currentUser);
        }

        function updateUserInfo(user) {
            const userNameHeader = document.getElementById('userNameHeader');
            const dropdownUserEmail = document.getElementById('dropdownUserEmail');

            if (userNameHeader) {
                const displayName = user.ho_ten || user.email.split('@')[0];
                userNameHeader.textContent = displayName.length > 20 ? displayName.substring(0, 20) + '...' : displayName;
            }

            if (dropdownUserEmail) {
                dropdownUserEmail.textContent = user.email;
            }
        }

        // ============================================================================
        // LOAD USER DATA
        // ============================================================================
        function loadUserData() {
            // Update avatar and display name
            const displayName = document.getElementById('displayName');
            const displayEmail = document.getElementById('displayEmail');
            const avatarInitials = document.getElementById('avatarInitials');
            const memberSince = document.getElementById('memberSince');

            const fullName = currentUser.ho_ten || 'Ng∆∞·ªùi d√πng';
            const email = currentUser.email;

            if (displayName) displayName.textContent = fullName;
            if (displayEmail) displayEmail.textContent = email;
            
            // Set avatar initials
            if (avatarInitials) {
                const names = fullName.split(' ');
                const initials = names.length > 1 
                    ? names[0][0] + names[names.length - 1][0]
                    : names[0][0];
                avatarInitials.textContent = initials.toUpperCase();
            }

            // Set member since
            if (memberSince) {
                const joinDate = currentUser.ngay_tao || new Date();
                const year = new Date(joinDate).getFullYear();
                memberSince.textContent = `Th√†nh vi√™n t·ª´ ${year}`;
            }

            // Load form data
            loadPersonalInfoForm();
            loadStats();
            loadNotificationSettings();
            loadPrivacySettings();
        }

        function loadPersonalInfoForm() {
            const names = (currentUser.ho_ten || '').split(' ');
            document.getElementById('firstName').value = names.slice(0, -1).join(' ') || '';
            document.getElementById('lastName').value = names[names.length - 1] || '';
            document.getElementById('email').value = currentUser.email || '';
            document.getElementById('phone').value = currentUser.sdt || '';
            document.getElementById('university').value = currentUser.truong || '';
            document.getElementById('major').value = currentUser.chuyen_nganh || '';
            document.getElementById('bio').value = currentUser.gioi_thieu || '';
        }

        function loadStats() {
            // Load real stats from API
            const token = localStorage.getItem('token');
            if (!token) {
                // If not logged in, show 0 for all stats
                document.getElementById('statDocuments').textContent = '0';
                document.getElementById('statViews').textContent = '0';
                document.getElementById('statDownloads').textContent = '0';
                document.getElementById('statLikes').textContent = '0';
                document.getElementById('statComments').textContent = '0';
                document.getElementById('statRating').textContent = '0.0';
                return;
            }

            fetch('http://localhost:3000/api/users/me/stats', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById('statDocuments').textContent = data.documents || 0;
                document.getElementById('statViews').textContent = formatNumber(data.views || 0);
                document.getElementById('statDownloads').textContent = formatNumber(data.downloads || 0);
                document.getElementById('statLikes').textContent = '0'; // Not implemented yet
                document.getElementById('statComments').textContent = data.comments || 0;
                document.getElementById('statRating').textContent = data.rating || '0.0';
            })
            .catch(error => {
                console.error('Error loading stats:', error);
                // Show 0 on error
                document.getElementById('statDocuments').textContent = '0';
                document.getElementById('statViews').textContent = '0';
                document.getElementById('statDownloads').textContent = '0';
                document.getElementById('statLikes').textContent = '0';
                document.getElementById('statComments').textContent = '0';
                document.getElementById('statRating').textContent = '0.0';
            });
        }

        function formatNumber(num) {
            if (num >= 1000) {
                return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
            }
            return num.toString();
        }

        function loadNotificationSettings() {
            // Load from localStorage or API
            notificationSettings = JSON.parse(localStorage.getItem('notificationSettings')) || {
                email_approved: true,
                email_comments: true,
                email_likes: false,
                email_newsletter: true,
                web_notifications: true,
                notification_sound: false
            };
        }

        function loadPrivacySettings() {
            // Load from localStorage or API
            privacySettings = JSON.parse(localStorage.getItem('privacySettings')) || {
                public_profile: true,
                show_email: false,
                show_phone: false,
                allow_comments: true,
                show_stats: true
            };
        }

        // ============================================================================
        // SECTION NAVIGATION
        // ============================================================================
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.profile-section').forEach(section => {
                section.classList.remove('active');
            });

            // Show selected section
            const section = document.getElementById(`section-${sectionName}`);
            if (section) {
                section.classList.add('active');
            }

            // Update nav items
            document.querySelectorAll('.profile-nav-item').forEach(item => {
                item.classList.remove('active');
            });

            const navItem = document.querySelector(`[data-section="${sectionName}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }

            // Scroll to top
            scrollToTop();
        }

        // ============================================================================
        // PERSONAL INFO
        // ============================================================================
        document.getElementById('personalInfoForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            showLoading();

            const formData = {
                ho_ten: `${document.getElementById('firstName').value} ${document.getElementById('lastName').value}`.trim(),
                sdt: document.getElementById('phone').value,
                truong: document.getElementById('university').value,
                chuyen_nganh: document.getElementById('major').value,
                gioi_thieu: document.getElementById('bio').value
            };

            try {
                // API call would go here
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Update current user
                Object.assign(currentUser, formData);
                localStorage.setItem('user', JSON.stringify(currentUser));

                hideLoading();
                showToast('C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!', 'success');
                
                // Update display
                document.getElementById('displayName').textContent = formData.ho_ten;
                updateUserInfo(currentUser);

            } catch (error) {
                hideLoading();
                console.error('Update error:', error);
                showToast('C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i!', 'error');
            }
        });

        function resetPersonalInfo() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒë·∫∑t l·∫°i th√¥ng tin?')) {
                loadPersonalInfoForm();
                showToast('ƒê√£ ƒë·∫∑t l·∫°i th√¥ng tin', 'info');
            }
        }

        // ============================================================================
        // AVATAR UPLOAD
        // ============================================================================
        function handleAvatarUpload(event) {
            const file = event.target.files[0];
            
            if (!file) return;

            // Validate file
            if (!file.type.startsWith('image/')) {
                showToast('Vui l√≤ng ch·ªçn file ·∫£nh', 'error');
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                showToast('K√≠ch th∆∞·ªõc ·∫£nh t·ªëi ƒëa 5MB', 'error');
                return;
            }

            // Preview
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('userAvatar');
                const placeholder = document.getElementById('avatarPlaceholder');
                
                img.src = e.target.result;
                img.style.display = 'block';
                placeholder.style.display = 'none';

                // In production, upload to server here
                showToast('ƒêang t·∫£i ·∫£nh l√™n...', 'info');
                
                setTimeout(() => {
                    showToast('C·∫≠p nh·∫≠t ·∫£nh ƒë·∫°i di·ªán th√†nh c√¥ng!', 'success');
                }, 1000);
            };

            reader.readAsDataURL(file);
        }

        // ============================================================================
        // PASSWORD
        // ============================================================================
        document.getElementById('passwordForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Validate
            if (newPassword !== confirmPassword) {
                showToast('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp', 'error');
                return;
            }

            if (!validatePassword(newPassword)) {
                showToast('M·∫≠t kh·∫©u ch∆∞a ƒë·ªß m·∫°nh', 'error');
                return;
            }

            showLoading();

            try {
                // API call would go here
                await new Promise(resolve => setTimeout(resolve, 1500));

                hideLoading();
                showToast('ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!', 'success');
                document.getElementById('passwordForm').reset();
                checkPasswordStrength();

            } catch (error) {
                hideLoading();
                console.error('Password change error:', error);
                showToast('C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i!', 'error');
            }
        });

        function checkPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthBar = document.getElementById('passwordStrengthBar');
            
            // Reset
            strengthBar.className = 'password-strength-bar';
            
            if (!password) return;

            // Check requirements
            const requirements = {
                'req-length': password.length >= 8,
                'req-uppercase': /[A-Z]/.test(password),
                'req-lowercase': /[a-z]/.test(password),
                'req-number': /[0-9]/.test(password),
                'req-special': /[!@#$%^&*(),.?":{}|<>]/.test(password)
            };

            // Update requirement indicators
            Object.keys(requirements).forEach(key => {
                const element = document.getElementById(key);
                if (requirements[key]) {
                    element.classList.add('met');
                    element.classList.remove('not-met');
                    element.querySelector('span').textContent = '‚úì';
                } else {
                    element.classList.remove('met');
                    element.classList.add('not-met');
                    element.querySelector('span').textContent = '‚óã';
                }
            });

            // Calculate strength
            const metCount = Object.values(requirements).filter(Boolean).length;
            
            if (metCount <= 2) {
                strengthBar.classList.add('weak');
            } else if (metCount <= 4) {
                strengthBar.classList.add('medium');
            } else {
                strengthBar.classList.add('strong');
            }
        }

        function validatePassword(password) {
            return password.length >= 8 &&
                   /[A-Z]/.test(password) &&
                   /[a-z]/.test(password) &&
                   /[0-9]/.test(password) &&
                   /[!@#$%^&*(),.?":{}|<>]/.test(password);
        }

        // ============================================================================
        // SETTINGS TOGGLE
        // ============================================================================
        function toggleSetting(element, settingKey) {
            element.classList.toggle('active');
            
            // Update settings based on section
            if (settingKey.startsWith('email_') || settingKey.startsWith('web_') || settingKey.startsWith('notification_')) {
                notificationSettings[settingKey] = element.classList.contains('active');
            } else {
                privacySettings[settingKey] = element.classList.contains('active');
            }
        }

        function saveNotificationSettings() {
            showLoading();
            
            setTimeout(() => {
                localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
                hideLoading();
                showToast('ƒê√£ l∆∞u c√†i ƒë·∫∑t th√¥ng b√°o', 'success');
            }, 500);
        }

        function savePrivacySettings() {
            showLoading();
            
            setTimeout(() => {
                localStorage.setItem('privacySettings', JSON.stringify(privacySettings));
                hideLoading();
                showToast('ƒê√£ l∆∞u c√†i ƒë·∫∑t quy·ªÅn ri√™ng t∆∞', 'success');
            }, 500);
        }

        // ============================================================================
        // ACTIVITY LOG
        // ============================================================================
        function loadActivityLog() {
            const activityList = document.getElementById('activityList');
            
            // Mock data - replace with API call
            const activities = [
                {
                    icon: 'üì§',
                    title: 'T·∫£i l√™n t√†i li·ªáu m·ªõi',
                    description: 'B·∫°n ƒë√£ t·∫£i l√™n "Gi√°o tr√¨nh To√°n cao c·∫•p A1.pdf"',
                    time: '2 gi·ªù tr∆∞·ªõc'
                },
                {
                    icon: 'üí¨',
                    title: 'B√¨nh lu·∫≠n m·ªõi',
                    description: 'Nguy·ªÖn VƒÉn A ƒë√£ b√¨nh lu·∫≠n v√†o t√†i li·ªáu c·ªßa b·∫°n',
                    time: '5 gi·ªù tr∆∞·ªõc'
                },
                {
                    icon: '‚ù§Ô∏è',
                    title: 'L∆∞·ª£t th√≠ch',
                    description: '10 ng∆∞·ªùi ƒë√£ th√≠ch t√†i li·ªáu "C·∫•u tr√∫c d·ªØ li·ªáu"',
                    time: '1 ng√†y tr∆∞·ªõc'
                },
                {
                    icon: '‚¨áÔ∏è',
                    title: 'T·∫£i xu·ªëng',
                    description: 'T√†i li·ªáu c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c t·∫£i xu·ªëng 50 l·∫ßn',
                    time: '2 ng√†y tr∆∞·ªõc'
                },
                {
                    icon: '‚úÖ',
                    title: 'T√†i li·ªáu ƒë∆∞·ª£c duy·ªát',
                    description: 'T√†i li·ªáu "L·∫≠p tr√¨nh Python" ƒë√£ ƒë∆∞·ª£c ph√™ duy·ªát',
                    time: '3 ng√†y tr∆∞·ªõc'
                }
            ];

            activityList.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-icon">${activity.icon}</div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.title}</div>
                        <div class="activity-description">${activity.description}</div>
                        <div class="activity-time">${activity.time}</div>
                    </div>
                </div>
            `).join('');
        }

        function clearActivityLog() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ ho·∫°t ƒë·ªông?')) {
                showLoading();
                
                setTimeout(() => {
                    document.getElementById('activityList').innerHTML = `
                        <div style="text-align: center; padding: 60px 20px; color: #999;">
                            <div style="font-size: 3rem; margin-bottom: 15px;">üì≠</div>
                            <p>Kh√¥ng c√≥ ho·∫°t ƒë·ªông n√†o</p>
                        </div>
                    `;
                    hideLoading();
                    showToast('ƒê√£ x√≥a l·ªãch s·ª≠ ho·∫°t ƒë·ªông', 'success');
                }, 500);
            }
        }

        // ============================================================================
        // ACCOUNT MANAGEMENT
        // ============================================================================
        function setup2FA() {
            showToast('T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn', 'info');
        }

        function manageSessions() {
            showToast('T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn', 'info');
        }

        function exportData() {
            showLoading();
            
            setTimeout(() => {
                // Create mock export
                const data = {
                    user: currentUser,
                    exportDate: new Date().toISOString(),
                    documents: [],
                    activities: []
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `docshare-export-${Date.now()}.json`;
                a.click();
                
                hideLoading();
                showToast('ƒê√£ xu·∫•t d·ªØ li·ªáu th√†nh c√¥ng', 'success');
            }, 1000);
        }

        function backupAccount() {
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                showToast('ƒê√£ t·∫°o b·∫£n sao l∆∞u th√†nh c√¥ng', 'success');
            }, 1500);
        }

        // ============================================================================
        // DELETE ACCOUNT
        // ============================================================================
        function openDeleteModal() {
            document.getElementById('deleteAccountModal').classList.add('show');
        }

        function closeDeleteModal() {
            document.getElementById('deleteAccountModal').classList.remove('show');
            document.getElementById('deleteConfirmPassword').value = '';
        }

        function confirmDeleteAccount() {
            const password = document.getElementById('deleteConfirmPassword').value;
            
            if (!password) {
                showToast('Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u', 'error');
                return;
            }

            if (confirm('C·∫¢NH B√ÅO: B·∫°n TH·ª∞C S·ª∞ mu·ªën x√≥a t√†i kho·∫£n? H√†nh ƒë·ªông n√†y KH√îNG TH·ªÇ ho√†n t√°c!')) {
                showLoading();
                
                setTimeout(() => {
                    // API call to delete account
                    closeDeleteModal();
                    hideLoading();
                    showToast('T√†i kho·∫£n ƒë√£ ƒë∆∞·ª£c x√≥a', 'success');
                    
                    setTimeout(() => {
                        logout();
                    }, 2000);
                }, 1500);
            }
        }

        // ============================================================================
        // UI CONTROLS
        // ============================================================================
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdownMenu');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }

        function toggleMobileMenu() {
            const nav = document.querySelector('.nav');
            if (nav) {
                nav.classList.toggle('active');
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('userDropdownMenu');
            const dropdownBtn = document.querySelector('.user-dropdown-btn');
            
            if (dropdown && dropdownBtn) {
                if (!dropdown.contains(e.target) && !dropdownBtn.contains(e.target)) {
                    dropdown.classList.remove('show');
                }
            }
        });

        // Close modal on outside click
        document.getElementById('deleteAccountModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeDeleteModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeDeleteModal();
            }
        });
    </script>
</body>
</html>